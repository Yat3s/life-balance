<toolbar isBack="{{true}}" bgColor="bg-white"></toolbar>
<view class="min-h-screen">
  <!-- Tab Navigation -->
  <view class="flex justify-around pb-4 pt-8">
    <view class="flex flex-col items-center relative" bindtap="switchTab" data-tab="published">
      <view class="text-3xl font-medium mb-0dot5 {{activeTab === 'published' ? 'text-foreground' : 'text-gray'}}">
        {{userProducts ? userProducts.length : 0}}
      </view>
      <view class="text-sm {{activeTab === 'published' ? 'text-foreground' : 'text-gray'}}">
        发布记录
      </view>
      <view wx:if="{{activeTab === 'published'}}" class="absolute -bottom-2 w-10 h-1 bg-indigo-900 rounded-full"></view>
    </view>
    <view class="flex flex-col items-center relative" bindtap="switchTab" data-tab="purchases">
      <view class="text-3xl font-medium mb-0dot5 mb-1 {{activeTab === 'purchases' ? 'text-foreground' : 'text-gray'}}">
        {{userOrders ? userOrders.length : 0}}
      </view>
      <view class="text-sm {{activeTab === 'purchases' ? 'text-foreground' : 'text-gray'}}">
        我的购买
      </view>
      <view wx:if="{{activeTab === 'purchases'}}" class="absolute -bottom-2 w-10 h-1 bg-foreground rounded-full"></view>
    </view>
  </view>
  <!-- Product List -->
  <view class="p-4">
    <block wx:if="{{activeTab === 'published'}}">
      <block wx:if="{{!userProducts || userProducts.length === 0}}">
        <view class="flex items-center justify-center pt-40 text-foreground">暂无发布记录</view>
      </block>
      <block wx:else>
        <view wx:for="{{userProducts}}" wx:key="_id" class="flex bg-blue-gradient p-5 mb-4 rounded-lg">
          <view wx:if="{{item.pictures && item.pictures[0]}}" class="relative w-28 h-28 rounded-lg overflow-hidden" data-index="{{index}}">
            <image class="w-full h-full" src="{{item.pictures[0]}}" mode="aspectFill" />
            <image wx:if="{{item.saleStatus === 'off'}}" class="w-10 h-10 absolute right-1 top-1 z-20" src="/images/ic_sold.svg" />
          </view>
          <view class="flex-1 ml-6">
            <text class="text-sm line-clamp-2 {{item.saleStatus === 'off' ? 'text-sold' : 'text-foreground'}}">
              {{item.title}}
            </text>
            <view class="mt-3 flex justify-between items-center">
              <view class="flex gap-2">
                <block wx:if="{{item.categories && item.categories.length > 0}}">
                  <view class="text-custom-purple font-lesslight text-xs" wx:for="{{item.categories}}" wx:key="{{index}}">
                    {{item}}
                  </view>
                </block>
                <view class="text-custom-purple font-lesslight text-xs" wx:else>未分类</view>
              </view>
              <view class="text-lg font-bold flex items-baseline gap-1 {{item.saleStatus === 'off' ? 'text-sold' : 'text-foreground'}}">
                <text class="text-xs">¥</text>
                <text>{{item.price}}</text>
              </view>
            </view>
            <view class="flex justify-end mt-6 gap-4 relative">
              <view wx:if="{{(!item.pictures || item.pictures.length === 0) && item.saleStatus === 'off'}}" class="w-10 h-10 absolute left-2 -bottom-1">
                <image class="w-full h-full" src="/images/ic_sold.svg" />
              </view>
              <view class="px-3 py-1 border-primary rounded-md text-xxs text-primary" bindtap="toggleStatus" data-id="{{item._id}}">
                {{item.saleStatus === 'on' ? '下架' : '重新上架'}}
              </view>
              <view class="px-3 py-1 border-primary rounded-md text-xxs text-primary" bindtap="editProduct" data-id="{{item._id}}">
                编辑
              </view>
            </view>
          </view>
        </view>
      </block>
    </block>
    <block wx:else>
      <block wx:if="{{!purchasedProducts || purchasedProducts.length === 0}}">
        <view class="flex items-center justify-center pt-40 text-foreground">暂无购买记录</view>
      </block>
      <block wx:else>
        <view wx:for="{{purchasedProducts}}" wx:key="id" class="flex bg-blue-gradient p-6 mb-4 rounded-lg">
          <image wx:if="{{item.pictures && item.pictures[0]}}" class="w-28 h-28 rounded-lg" src="{{item.pictures[0]}}" mode="aspectFill" data-index="{{index}}" />
          <view class="flex-1 ml-6">
            <text class="text-sm line-clamp-2 text-foreground">{{item.title}}</text>
            <view class="mt-3 flex justify-between items-center">
              <view class="flex gap-2">
                <block wx:if="{{item.categories && item.categories.length > 0}}">
                  <view class="text-custom-purple font-lesslight text-xs" wx:for="{{item.categories}}" wx:key="{{index}}">
                    {{item}}
                  </view>
                </block>
                <view class="text-custom-purple font-lesslight text-xs" wx:else>未分类</view>
              </view>
              <view class="text-lg text-primary font-bold flex items-baseline gap-1">
                <text class="text-xs">¥</text>
                <text>{{item.price}}</text>
              </view>
            </view>
            <view class="flex justify-end mt-6 gap-4">
              <text class="text-sm text-gray-500 mt-2">{{item.purchaseDate}}</text>
              <view class="flex justify-end mt-6">
                <view class="px-8 py-2 border border-gray-300 rounded-full text-sm bg-white" bindtap="deleteOrder" data-id="{{item.id}}">
                  删除订单
                </view>
              </view>
            </view>
          </view>
        </view>
      </block>
    </block>
  </view>
</view>